{"ast":null,"code":"import { createChecksumStream } from \"@smithy/util-stream\";\nimport { ChecksumAlgorithm } from \"./constants\";\nimport { getChecksum } from \"./getChecksum\";\nimport { getChecksumAlgorithmListForResponse } from \"./getChecksumAlgorithmListForResponse\";\nimport { getChecksumLocationName } from \"./getChecksumLocationName\";\nimport { isStreaming } from \"./isStreaming\";\nimport { selectChecksumAlgorithmFunction } from \"./selectChecksumAlgorithmFunction\";\nexport const validateChecksumFromResponse = async (response, _ref) => {\n  let {\n    config,\n    responseAlgorithms,\n    logger\n  } = _ref;\n  const checksumAlgorithms = getChecksumAlgorithmListForResponse(responseAlgorithms);\n  const {\n    body: responseBody,\n    headers: responseHeaders\n  } = response;\n  for (const algorithm of checksumAlgorithms) {\n    const responseHeader = getChecksumLocationName(algorithm);\n    const checksumFromResponse = responseHeaders[responseHeader];\n    if (checksumFromResponse) {\n      let checksumAlgorithmFn;\n      try {\n        checksumAlgorithmFn = selectChecksumAlgorithmFunction(algorithm, config);\n      } catch (error) {\n        if (algorithm === ChecksumAlgorithm.CRC64NVME) {\n          logger === null || logger === void 0 || logger.warn(\"Skipping \".concat(ChecksumAlgorithm.CRC64NVME, \" checksum validation: \").concat(error.message));\n          continue;\n        }\n        throw error;\n      }\n      const {\n        base64Encoder\n      } = config;\n      if (isStreaming(responseBody)) {\n        response.body = createChecksumStream({\n          expectedChecksum: checksumFromResponse,\n          checksumSourceLocation: responseHeader,\n          checksum: new checksumAlgorithmFn(),\n          source: responseBody,\n          base64Encoder\n        });\n        return;\n      }\n      const checksum = await getChecksum(responseBody, {\n        checksumAlgorithmFn,\n        base64Encoder\n      });\n      if (checksum === checksumFromResponse) {\n        break;\n      }\n      throw new Error(\"Checksum mismatch: expected \\\"\".concat(checksum, \"\\\" but received \\\"\").concat(checksumFromResponse, \"\\\"\") + \" in response header \\\"\".concat(responseHeader, \"\\\".\"));\n    }\n  }\n};","map":{"version":3,"names":["createChecksumStream","ChecksumAlgorithm","getChecksum","getChecksumAlgorithmListForResponse","getChecksumLocationName","isStreaming","selectChecksumAlgorithmFunction","validateChecksumFromResponse","response","_ref","config","responseAlgorithms","logger","checksumAlgorithms","body","responseBody","headers","responseHeaders","algorithm","responseHeader","checksumFromResponse","checksumAlgorithmFn","error","CRC64NVME","warn","concat","message","base64Encoder","expectedChecksum","checksumSourceLocation","checksum","source","Error"],"sources":["/home/rcts/Email-differ/Frontend/node_modules/@aws-sdk/middleware-flexible-checksums/dist-es/validateChecksumFromResponse.js"],"sourcesContent":["import { createChecksumStream } from \"@smithy/util-stream\";\nimport { ChecksumAlgorithm } from \"./constants\";\nimport { getChecksum } from \"./getChecksum\";\nimport { getChecksumAlgorithmListForResponse } from \"./getChecksumAlgorithmListForResponse\";\nimport { getChecksumLocationName } from \"./getChecksumLocationName\";\nimport { isStreaming } from \"./isStreaming\";\nimport { selectChecksumAlgorithmFunction } from \"./selectChecksumAlgorithmFunction\";\nexport const validateChecksumFromResponse = async (response, { config, responseAlgorithms, logger }) => {\n    const checksumAlgorithms = getChecksumAlgorithmListForResponse(responseAlgorithms);\n    const { body: responseBody, headers: responseHeaders } = response;\n    for (const algorithm of checksumAlgorithms) {\n        const responseHeader = getChecksumLocationName(algorithm);\n        const checksumFromResponse = responseHeaders[responseHeader];\n        if (checksumFromResponse) {\n            let checksumAlgorithmFn;\n            try {\n                checksumAlgorithmFn = selectChecksumAlgorithmFunction(algorithm, config);\n            }\n            catch (error) {\n                if (algorithm === ChecksumAlgorithm.CRC64NVME) {\n                    logger?.warn(`Skipping ${ChecksumAlgorithm.CRC64NVME} checksum validation: ${error.message}`);\n                    continue;\n                }\n                throw error;\n            }\n            const { base64Encoder } = config;\n            if (isStreaming(responseBody)) {\n                response.body = createChecksumStream({\n                    expectedChecksum: checksumFromResponse,\n                    checksumSourceLocation: responseHeader,\n                    checksum: new checksumAlgorithmFn(),\n                    source: responseBody,\n                    base64Encoder,\n                });\n                return;\n            }\n            const checksum = await getChecksum(responseBody, { checksumAlgorithmFn, base64Encoder });\n            if (checksum === checksumFromResponse) {\n                break;\n            }\n            throw new Error(`Checksum mismatch: expected \"${checksum}\" but received \"${checksumFromResponse}\"` +\n                ` in response header \"${responseHeader}\".`);\n        }\n    }\n};\n"],"mappings":"AAAA,SAASA,oBAAoB,QAAQ,qBAAqB;AAC1D,SAASC,iBAAiB,QAAQ,aAAa;AAC/C,SAASC,WAAW,QAAQ,eAAe;AAC3C,SAASC,mCAAmC,QAAQ,uCAAuC;AAC3F,SAASC,uBAAuB,QAAQ,2BAA2B;AACnE,SAASC,WAAW,QAAQ,eAAe;AAC3C,SAASC,+BAA+B,QAAQ,mCAAmC;AACnF,OAAO,MAAMC,4BAA4B,GAAG,MAAAA,CAAOC,QAAQ,EAAAC,IAAA,KAA6C;EAAA,IAA3C;IAAEC,MAAM;IAAEC,kBAAkB;IAAEC;EAAO,CAAC,GAAAH,IAAA;EAC/F,MAAMI,kBAAkB,GAAGV,mCAAmC,CAACQ,kBAAkB,CAAC;EAClF,MAAM;IAAEG,IAAI,EAAEC,YAAY;IAAEC,OAAO,EAAEC;EAAgB,CAAC,GAAGT,QAAQ;EACjE,KAAK,MAAMU,SAAS,IAAIL,kBAAkB,EAAE;IACxC,MAAMM,cAAc,GAAGf,uBAAuB,CAACc,SAAS,CAAC;IACzD,MAAME,oBAAoB,GAAGH,eAAe,CAACE,cAAc,CAAC;IAC5D,IAAIC,oBAAoB,EAAE;MACtB,IAAIC,mBAAmB;MACvB,IAAI;QACAA,mBAAmB,GAAGf,+BAA+B,CAACY,SAAS,EAAER,MAAM,CAAC;MAC5E,CAAC,CACD,OAAOY,KAAK,EAAE;QACV,IAAIJ,SAAS,KAAKjB,iBAAiB,CAACsB,SAAS,EAAE;UAC3CX,MAAM,aAANA,MAAM,eAANA,MAAM,CAAEY,IAAI,aAAAC,MAAA,CAAaxB,iBAAiB,CAACsB,SAAS,4BAAAE,MAAA,CAAyBH,KAAK,CAACI,OAAO,CAAE,CAAC;UAC7F;QACJ;QACA,MAAMJ,KAAK;MACf;MACA,MAAM;QAAEK;MAAc,CAAC,GAAGjB,MAAM;MAChC,IAAIL,WAAW,CAACU,YAAY,CAAC,EAAE;QAC3BP,QAAQ,CAACM,IAAI,GAAGd,oBAAoB,CAAC;UACjC4B,gBAAgB,EAAER,oBAAoB;UACtCS,sBAAsB,EAAEV,cAAc;UACtCW,QAAQ,EAAE,IAAIT,mBAAmB,CAAC,CAAC;UACnCU,MAAM,EAAEhB,YAAY;UACpBY;QACJ,CAAC,CAAC;QACF;MACJ;MACA,MAAMG,QAAQ,GAAG,MAAM5B,WAAW,CAACa,YAAY,EAAE;QAAEM,mBAAmB;QAAEM;MAAc,CAAC,CAAC;MACxF,IAAIG,QAAQ,KAAKV,oBAAoB,EAAE;QACnC;MACJ;MACA,MAAM,IAAIY,KAAK,CAAC,iCAAAP,MAAA,CAAgCK,QAAQ,wBAAAL,MAAA,CAAmBL,oBAAoB,mCAAAK,MAAA,CACnEN,cAAc,QAAI,CAAC;IACnD;EACJ;AACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}