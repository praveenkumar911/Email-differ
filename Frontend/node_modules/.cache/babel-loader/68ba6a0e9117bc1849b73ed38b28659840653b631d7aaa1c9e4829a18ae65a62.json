{"ast":null,"code":"// src/api/apiService.js\nimport axios from\"axios\";// üåç Base URL setup (local + production)\n// Allow env to provide http://localhost:8000 or http://10.8.0.15:8000/api\nconst rawBase=process.env.VITE_REACT_APP_API_BASE_URL||\"https://pl-api.iiit.ac.in/rcts/account-setup/api\";// Ensure baseURL always ends with /api\nconst normalized=(()=>{try{const trimmed=String(rawBase).replace(/\\/+$/,\"\");return trimmed.endsWith(\"/api\")?trimmed:\"\".concat(trimmed,\"/api\");}catch(_unused){return\"https://pl-api.iiit.ac.in/rcts/account-setup/api\";}})();const API=axios.create({baseURL:normalized,headers:{\"Content-Type\":\"application/json\"}});// ------------------------------\n// üßæ FORM UPDATE FLOW (existing email system)\n// ------------------------------\nexport const validateToken=token=>API.get(\"/form/validate/\".concat(token));export const submitForm=data=>API.post(\"/form/submit\",data);export const deferForm=data=>API.post(\"/form/defer\",data);export const optOut=_ref=>{let{token,reason}=_ref;return API.post(\"/form/optout\",{token,reason});};// ------------------------------\n// üì± AUTH FLOW (Firebase OTP-based signup/login system)\n// ------------------------------\n// 1Ô∏è‚É£ Signup (register a new user ‚Äî creates pending record on backend)\nexport const signupUser=async formData=>{try{const res=await API.post(\"/users/signup\",formData);return res.data;}catch(err){var _err$response,_err$response2;console.error(\"‚ùå Signup error:\",((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.data)||err.message);throw((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.data)||{message:\"Server error\"};}};// Pre-check: ask backend if phone/email exists\nexport const requestOtp=async _ref2=>{let{phone,email}=_ref2;try{const res=await API.post('/users/request-otp',{phone,email});return res.data;}catch(err){var _err$response3,_err$response4;console.error('‚ùå requestOtp error:',((_err$response3=err.response)===null||_err$response3===void 0?void 0:_err$response3.data)||err.message);throw((_err$response4=err.response)===null||_err$response4===void 0?void 0:_err$response4.data)||{message:'Server error'};}};// 2Ô∏è‚É£ (Optional) Signin ‚Äî previously used to request dummy OTP\n// With Firebase, OTP is now handled on frontend.\n// Keep this function for compatibility (may not be needed later).\nexport const signinUser=async identifier=>{try{const res=await API.post(\"/auth/signin\",identifier);return res.data;}catch(err){var _err$response5,_err$response6;console.error(\"‚ùå Signin error:\",((_err$response5=err.response)===null||_err$response5===void 0?void 0:_err$response5.data)||err.message);throw((_err$response6=err.response)===null||_err$response6===void 0?void 0:_err$response6.data)||{message:\"Server error\"};}};// 3Ô∏è‚É£ Verify Firebase OTP (for both signup & login)\n//    Payload must contain: { firebaseToken }\nexport const verifyOtp=async payload=>{try{const{firebaseToken,phoneNumber}=payload;const res=await API.post(\"/login\",{firebaseToken,phoneNumber// <--- SEND CORRECT FIELD\n});return res.data;}catch(err){var _err$response7;throw((_err$response7=err.response)===null||_err$response7===void 0?void 0:_err$response7.data)||{message:\"Server error\"};}};// 4Ô∏è‚É£ Alias for backward compatibility\nexport const verifyLoginOtp=async payload=>{return verifyOtp(payload);};// 5Ô∏è‚É£ Protected route example (for later role-based auth)\nexport const getProtectedData=async token=>{try{const res=await API.get(\"/auth/protected\",{headers:{Authorization:\"Bearer \".concat(token)}});return res.data;}catch(err){var _err$response8,_err$response9;console.error(\"‚ùå Protected route error:\",((_err$response8=err.response)===null||_err$response8===void 0?void 0:_err$response8.data)||err.message);throw((_err$response9=err.response)===null||_err$response9===void 0?void 0:_err$response9.data)||{message:\"Server error\"};}};export default API;","map":{"version":3,"names":["axios","rawBase","process","env","VITE_REACT_APP_API_BASE_URL","normalized","trimmed","String","replace","endsWith","concat","_unused","API","create","baseURL","headers","validateToken","token","get","submitForm","data","post","deferForm","optOut","_ref","reason","signupUser","formData","res","err","_err$response","_err$response2","console","error","response","message","requestOtp","_ref2","phone","email","_err$response3","_err$response4","signinUser","identifier","_err$response5","_err$response6","verifyOtp","payload","firebaseToken","phoneNumber","_err$response7","verifyLoginOtp","getProtectedData","Authorization","_err$response8","_err$response9"],"sources":["/home/rcts/Email-differ/Frontend/src/api/apiService.js"],"sourcesContent":["// src/api/apiService.js\nimport axios from \"axios\";\n\n// üåç Base URL setup (local + production)\n// Allow env to provide http://localhost:8000 or http://10.8.0.15:8000/api\nconst rawBase =\n  process.env.VITE_REACT_APP_API_BASE_URL || \"https://pl-api.iiit.ac.in/rcts/account-setup/api\";\n\n// Ensure baseURL always ends with /api\nconst normalized = (() => {\n  try {\n    const trimmed = String(rawBase).replace(/\\/+$/, \"\");\n    return trimmed.endsWith(\"/api\") ? trimmed : `${trimmed}/api`;\n  } catch {\n    return \"https://pl-api.iiit.ac.in/rcts/account-setup/api\";\n  }\n})();\n\nconst API = axios.create({\n  baseURL: normalized,\n  headers: { \"Content-Type\": \"application/json\" },\n});\n\n// ------------------------------\n// üßæ FORM UPDATE FLOW (existing email system)\n// ------------------------------\nexport const validateToken = (token) => API.get(`/form/validate/${token}`);\nexport const submitForm = (data) => API.post(\"/form/submit\", data);\nexport const deferForm = (data) => API.post(\"/form/defer\", data);\nexport const optOut = ({ token, reason }) =>\n  API.post(\"/form/optout\", { token, reason });\n\n// ------------------------------\n// üì± AUTH FLOW (Firebase OTP-based signup/login system)\n// ------------------------------\n\n// 1Ô∏è‚É£ Signup (register a new user ‚Äî creates pending record on backend)\nexport const signupUser = async (formData) => {\n  try {\n    const res = await API.post(\"/users/signup\", formData);\n    return res.data;\n  } catch (err) {\n    console.error(\"‚ùå Signup error:\", err.response?.data || err.message);\n    throw err.response?.data || { message: \"Server error\" };\n  }\n};\n\n// Pre-check: ask backend if phone/email exists\nexport const requestOtp = async ({ phone, email }) => {\n  try {\n    const res = await API.post('/users/request-otp', { phone, email });\n    return res.data;\n  } catch (err) {\n    console.error('‚ùå requestOtp error:', err.response?.data || err.message);\n    throw err.response?.data || { message: 'Server error' };\n  }\n};\n\n// 2Ô∏è‚É£ (Optional) Signin ‚Äî previously used to request dummy OTP\n// With Firebase, OTP is now handled on frontend.\n// Keep this function for compatibility (may not be needed later).\nexport const signinUser = async (identifier) => {\n  try {\n    const res = await API.post(\"/auth/signin\", identifier);\n    return res.data;\n  } catch (err) {\n    console.error(\"‚ùå Signin error:\", err.response?.data || err.message);\n    throw err.response?.data || { message: \"Server error\" };\n  }\n};\n\n// 3Ô∏è‚É£ Verify Firebase OTP (for both signup & login)\n//    Payload must contain: { firebaseToken }\nexport const verifyOtp = async (payload) => {\n  try {\n    const { firebaseToken, phoneNumber } = payload;\n\n    const res = await API.post(\"/login\", {\n      firebaseToken,\n      phoneNumber,   // <--- SEND CORRECT FIELD\n    });\n\n    return res.data;\n  } catch (err) {\n    throw err.response?.data || { message: \"Server error\" };\n  }\n};\n\n\n// 4Ô∏è‚É£ Alias for backward compatibility\nexport const verifyLoginOtp = async (payload) => {\n  return verifyOtp(payload);\n};\n\n\n// 5Ô∏è‚É£ Protected route example (for later role-based auth)\nexport const getProtectedData = async (token) => {\n  try {\n    const res = await API.get(\"/auth/protected\", {\n      headers: { Authorization: `Bearer ${token}` },\n    });\n    return res.data;\n  } catch (err) {\n    console.error(\n      \"‚ùå Protected route error:\",\n      err.response?.data || err.message\n    );\n    throw err.response?.data || { message: \"Server error\" };\n  }\n};\n\nexport default API;\n"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,KAAM,OAAO,CAEzB;AACA;AACA,KAAM,CAAAC,OAAO,CACXC,OAAO,CAACC,GAAG,CAACC,2BAA2B,EAAI,kDAAkD,CAE/F;AACA,KAAM,CAAAC,UAAU,CAAG,CAAC,IAAM,CACxB,GAAI,CACF,KAAM,CAAAC,OAAO,CAAGC,MAAM,CAACN,OAAO,CAAC,CAACO,OAAO,CAAC,MAAM,CAAE,EAAE,CAAC,CACnD,MAAO,CAAAF,OAAO,CAACG,QAAQ,CAAC,MAAM,CAAC,CAAGH,OAAO,IAAAI,MAAA,CAAMJ,OAAO,QAAM,CAC9D,CAAE,MAAAK,OAAA,CAAM,CACN,MAAO,kDAAkD,CAC3D,CACF,CAAC,EAAE,CAAC,CAEJ,KAAM,CAAAC,GAAG,CAAGZ,KAAK,CAACa,MAAM,CAAC,CACvBC,OAAO,CAAET,UAAU,CACnBU,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAChD,CAAC,CAAC,CAEF;AACA;AACA;AACA,MAAO,MAAM,CAAAC,aAAa,CAAIC,KAAK,EAAKL,GAAG,CAACM,GAAG,mBAAAR,MAAA,CAAmBO,KAAK,CAAE,CAAC,CAC1E,MAAO,MAAM,CAAAE,UAAU,CAAIC,IAAI,EAAKR,GAAG,CAACS,IAAI,CAAC,cAAc,CAAED,IAAI,CAAC,CAClE,MAAO,MAAM,CAAAE,SAAS,CAAIF,IAAI,EAAKR,GAAG,CAACS,IAAI,CAAC,aAAa,CAAED,IAAI,CAAC,CAChE,MAAO,MAAM,CAAAG,MAAM,CAAGC,IAAA,MAAC,CAAEP,KAAK,CAAEQ,MAAO,CAAC,CAAAD,IAAA,OACtC,CAAAZ,GAAG,CAACS,IAAI,CAAC,cAAc,CAAE,CAAEJ,KAAK,CAAEQ,MAAO,CAAC,CAAC,GAE7C;AACA;AACA;AAEA;AACA,MAAO,MAAM,CAAAC,UAAU,CAAG,KAAO,CAAAC,QAAQ,EAAK,CAC5C,GAAI,CACF,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAAhB,GAAG,CAACS,IAAI,CAAC,eAAe,CAAEM,QAAQ,CAAC,CACrD,MAAO,CAAAC,GAAG,CAACR,IAAI,CACjB,CAAE,MAAOS,GAAG,CAAE,KAAAC,aAAA,CAAAC,cAAA,CACZC,OAAO,CAACC,KAAK,CAAC,iBAAiB,CAAE,EAAAH,aAAA,CAAAD,GAAG,CAACK,QAAQ,UAAAJ,aAAA,iBAAZA,aAAA,CAAcV,IAAI,GAAIS,GAAG,CAACM,OAAO,CAAC,CACnE,KAAM,EAAAJ,cAAA,CAAAF,GAAG,CAACK,QAAQ,UAAAH,cAAA,iBAAZA,cAAA,CAAcX,IAAI,GAAI,CAAEe,OAAO,CAAE,cAAe,CAAC,CACzD,CACF,CAAC,CAED;AACA,MAAO,MAAM,CAAAC,UAAU,CAAG,MAAAC,KAAA,EAA4B,IAArB,CAAEC,KAAK,CAAEC,KAAM,CAAC,CAAAF,KAAA,CAC/C,GAAI,CACF,KAAM,CAAAT,GAAG,CAAG,KAAM,CAAAhB,GAAG,CAACS,IAAI,CAAC,oBAAoB,CAAE,CAAEiB,KAAK,CAAEC,KAAM,CAAC,CAAC,CAClE,MAAO,CAAAX,GAAG,CAACR,IAAI,CACjB,CAAE,MAAOS,GAAG,CAAE,KAAAW,cAAA,CAAAC,cAAA,CACZT,OAAO,CAACC,KAAK,CAAC,qBAAqB,CAAE,EAAAO,cAAA,CAAAX,GAAG,CAACK,QAAQ,UAAAM,cAAA,iBAAZA,cAAA,CAAcpB,IAAI,GAAIS,GAAG,CAACM,OAAO,CAAC,CACvE,KAAM,EAAAM,cAAA,CAAAZ,GAAG,CAACK,QAAQ,UAAAO,cAAA,iBAAZA,cAAA,CAAcrB,IAAI,GAAI,CAAEe,OAAO,CAAE,cAAe,CAAC,CACzD,CACF,CAAC,CAED;AACA;AACA;AACA,MAAO,MAAM,CAAAO,UAAU,CAAG,KAAO,CAAAC,UAAU,EAAK,CAC9C,GAAI,CACF,KAAM,CAAAf,GAAG,CAAG,KAAM,CAAAhB,GAAG,CAACS,IAAI,CAAC,cAAc,CAAEsB,UAAU,CAAC,CACtD,MAAO,CAAAf,GAAG,CAACR,IAAI,CACjB,CAAE,MAAOS,GAAG,CAAE,KAAAe,cAAA,CAAAC,cAAA,CACZb,OAAO,CAACC,KAAK,CAAC,iBAAiB,CAAE,EAAAW,cAAA,CAAAf,GAAG,CAACK,QAAQ,UAAAU,cAAA,iBAAZA,cAAA,CAAcxB,IAAI,GAAIS,GAAG,CAACM,OAAO,CAAC,CACnE,KAAM,EAAAU,cAAA,CAAAhB,GAAG,CAACK,QAAQ,UAAAW,cAAA,iBAAZA,cAAA,CAAczB,IAAI,GAAI,CAAEe,OAAO,CAAE,cAAe,CAAC,CACzD,CACF,CAAC,CAED;AACA;AACA,MAAO,MAAM,CAAAW,SAAS,CAAG,KAAO,CAAAC,OAAO,EAAK,CAC1C,GAAI,CACF,KAAM,CAAEC,aAAa,CAAEC,WAAY,CAAC,CAAGF,OAAO,CAE9C,KAAM,CAAAnB,GAAG,CAAG,KAAM,CAAAhB,GAAG,CAACS,IAAI,CAAC,QAAQ,CAAE,CACnC2B,aAAa,CACbC,WAAe;AACjB,CAAC,CAAC,CAEF,MAAO,CAAArB,GAAG,CAACR,IAAI,CACjB,CAAE,MAAOS,GAAG,CAAE,KAAAqB,cAAA,CACZ,KAAM,EAAAA,cAAA,CAAArB,GAAG,CAACK,QAAQ,UAAAgB,cAAA,iBAAZA,cAAA,CAAc9B,IAAI,GAAI,CAAEe,OAAO,CAAE,cAAe,CAAC,CACzD,CACF,CAAC,CAGD;AACA,MAAO,MAAM,CAAAgB,cAAc,CAAG,KAAO,CAAAJ,OAAO,EAAK,CAC/C,MAAO,CAAAD,SAAS,CAACC,OAAO,CAAC,CAC3B,CAAC,CAGD;AACA,MAAO,MAAM,CAAAK,gBAAgB,CAAG,KAAO,CAAAnC,KAAK,EAAK,CAC/C,GAAI,CACF,KAAM,CAAAW,GAAG,CAAG,KAAM,CAAAhB,GAAG,CAACM,GAAG,CAAC,iBAAiB,CAAE,CAC3CH,OAAO,CAAE,CAAEsC,aAAa,WAAA3C,MAAA,CAAYO,KAAK,CAAG,CAC9C,CAAC,CAAC,CACF,MAAO,CAAAW,GAAG,CAACR,IAAI,CACjB,CAAE,MAAOS,GAAG,CAAE,KAAAyB,cAAA,CAAAC,cAAA,CACZvB,OAAO,CAACC,KAAK,CACX,0BAA0B,CAC1B,EAAAqB,cAAA,CAAAzB,GAAG,CAACK,QAAQ,UAAAoB,cAAA,iBAAZA,cAAA,CAAclC,IAAI,GAAIS,GAAG,CAACM,OAC5B,CAAC,CACD,KAAM,EAAAoB,cAAA,CAAA1B,GAAG,CAACK,QAAQ,UAAAqB,cAAA,iBAAZA,cAAA,CAAcnC,IAAI,GAAI,CAAEe,OAAO,CAAE,cAAe,CAAC,CACzD,CACF,CAAC,CAED,cAAe,CAAAvB,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}