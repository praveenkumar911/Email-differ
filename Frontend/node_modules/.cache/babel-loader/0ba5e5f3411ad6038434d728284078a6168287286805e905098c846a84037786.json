{"ast":null,"code":"// src/utils/setupRecaptcha.js\nimport{RecaptchaVerifier}from\"firebase/auth\";// Global singleton\nlet verifierPromise=null;export const forceResetRecaptchaPromise=()=>{verifierPromise=null;};export const setupRecaptcha=(auth,containerId)=>{// Return existing promise if already setting up\nif(verifierPromise){return verifierPromise;}verifierPromise=(async()=>{try{// Clean container\nconst container=document.getElementById(containerId);if(container)container.innerHTML=\"\";// Clear old verifier\nif(window.recaptchaVerifier){try{window.recaptchaVerifier.clear();}catch(_unused){}window.recaptchaVerifier=null;}// Create new verifier\nwindow.recaptchaVerifier=new RecaptchaVerifier(auth,containerId,{size:\"invisible\",callback:()=>console.log(\"reCAPTCHA solved\"),\"expired-callback\":()=>console.warn(\"reCAPTCHA expired\")});// This is the key: wrap render() in a way that NEVER rejects unhandled\ntry{await window.recaptchaVerifier.render();console.log(\"reCAPTCHA ready\");}catch(renderError){// Firebase sometimes throws here in dev — swallow it\nconsole.warn(\"reCAPTCHA render error (safe to ignore in dev):\",renderError);}return true;}catch(err){console.error(\"reCAPTCHA setup failed:\",err);window.recaptchaVerifier=null;return false;}})();// Always return the promise\nreturn verifierPromise;};// Optional cleanup\nexport const resetRecaptcha=()=>{if(window.recaptchaVerifier){try{window.recaptchaVerifier.clear();}catch(_unused2){}window.recaptchaVerifier=null;}verifierPromise=null;// Clear containers\ndocument.querySelectorAll('div[id^=\"recaptcha-container\"]').forEach(div=>{div.innerHTML=\"\";});};","map":{"version":3,"names":["RecaptchaVerifier","verifierPromise","forceResetRecaptchaPromise","setupRecaptcha","auth","containerId","container","document","getElementById","innerHTML","window","recaptchaVerifier","clear","_unused","size","callback","console","log","expired-callback","warn","render","renderError","err","error","resetRecaptcha","_unused2","querySelectorAll","forEach","div"],"sources":["/home/rcts/Email-differ/Frontend/src/utils/setupRecaptcha.js"],"sourcesContent":["// src/utils/setupRecaptcha.js\r\nimport { RecaptchaVerifier } from \"firebase/auth\";\r\n\r\n// Global singleton\r\nlet verifierPromise = null;\r\n\r\nexport const forceResetRecaptchaPromise = () => {\r\n  verifierPromise = null;\r\n};\r\n\r\nexport const setupRecaptcha = (auth, containerId) => {\r\n  // Return existing promise if already setting up\r\n  if (verifierPromise) {\r\n    return verifierPromise;\r\n  }\r\n\r\n  verifierPromise = (async () => {\r\n    try {\r\n      // Clean container\r\n      const container = document.getElementById(containerId);\r\n      if (container) container.innerHTML = \"\";\r\n\r\n      // Clear old verifier\r\n      if (window.recaptchaVerifier) {\r\n        try { window.recaptchaVerifier.clear(); } catch {}\r\n        window.recaptchaVerifier = null;\r\n      }\r\n\r\n      // Create new verifier\r\n      window.recaptchaVerifier = new RecaptchaVerifier(auth, containerId, {\r\n        size: \"invisible\",\r\n        callback: () => console.log(\"reCAPTCHA solved\"),\r\n        \"expired-callback\": () => console.warn(\"reCAPTCHA expired\"),\r\n      });\r\n\r\n      // This is the key: wrap render() in a way that NEVER rejects unhandled\r\n      try {\r\n        await window.recaptchaVerifier.render();\r\n        console.log(\"reCAPTCHA ready\");\r\n      } catch (renderError) {\r\n        // Firebase sometimes throws here in dev — swallow it\r\n        console.warn(\"reCAPTCHA render error (safe to ignore in dev):\", renderError);\r\n      }\r\n\r\n      return true;\r\n    } catch (err) {\r\n      console.error(\"reCAPTCHA setup failed:\", err);\r\n      window.recaptchaVerifier = null;\r\n      return false;\r\n    }\r\n  })();\r\n\r\n  // Always return the promise\r\n  return verifierPromise;\r\n};\r\n\r\n// Optional cleanup\r\nexport const resetRecaptcha = () => {\r\n  if (window.recaptchaVerifier) {\r\n    try { window.recaptchaVerifier.clear(); } catch {}\r\n    window.recaptchaVerifier = null;\r\n  }\r\n  verifierPromise = null;\r\n  \r\n  // Clear containers\r\n  document.querySelectorAll('div[id^=\"recaptcha-container\"]').forEach(div => {\r\n    div.innerHTML = \"\";\r\n  });\r\n};"],"mappings":"AAAA;AACA,OAASA,iBAAiB,KAAQ,eAAe,CAEjD;AACA,GAAI,CAAAC,eAAe,CAAG,IAAI,CAE1B,MAAO,MAAM,CAAAC,0BAA0B,CAAGA,CAAA,GAAM,CAC9CD,eAAe,CAAG,IAAI,CACxB,CAAC,CAED,MAAO,MAAM,CAAAE,cAAc,CAAGA,CAACC,IAAI,CAAEC,WAAW,GAAK,CACnD;AACA,GAAIJ,eAAe,CAAE,CACnB,MAAO,CAAAA,eAAe,CACxB,CAEAA,eAAe,CAAG,CAAC,SAAY,CAC7B,GAAI,CACF;AACA,KAAM,CAAAK,SAAS,CAAGC,QAAQ,CAACC,cAAc,CAACH,WAAW,CAAC,CACtD,GAAIC,SAAS,CAAEA,SAAS,CAACG,SAAS,CAAG,EAAE,CAEvC;AACA,GAAIC,MAAM,CAACC,iBAAiB,CAAE,CAC5B,GAAI,CAAED,MAAM,CAACC,iBAAiB,CAACC,KAAK,CAAC,CAAC,CAAE,CAAE,MAAAC,OAAA,CAAM,CAAC,CACjDH,MAAM,CAACC,iBAAiB,CAAG,IAAI,CACjC,CAEA;AACAD,MAAM,CAACC,iBAAiB,CAAG,GAAI,CAAAX,iBAAiB,CAACI,IAAI,CAAEC,WAAW,CAAE,CAClES,IAAI,CAAE,WAAW,CACjBC,QAAQ,CAAEA,CAAA,GAAMC,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAC,CAC/C,kBAAkB,CAAEC,CAAA,GAAMF,OAAO,CAACG,IAAI,CAAC,mBAAmB,CAC5D,CAAC,CAAC,CAEF;AACA,GAAI,CACF,KAAM,CAAAT,MAAM,CAACC,iBAAiB,CAACS,MAAM,CAAC,CAAC,CACvCJ,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC,CAChC,CAAE,MAAOI,WAAW,CAAE,CACpB;AACAL,OAAO,CAACG,IAAI,CAAC,iDAAiD,CAAEE,WAAW,CAAC,CAC9E,CAEA,MAAO,KAAI,CACb,CAAE,MAAOC,GAAG,CAAE,CACZN,OAAO,CAACO,KAAK,CAAC,yBAAyB,CAAED,GAAG,CAAC,CAC7CZ,MAAM,CAACC,iBAAiB,CAAG,IAAI,CAC/B,MAAO,MAAK,CACd,CACF,CAAC,EAAE,CAAC,CAEJ;AACA,MAAO,CAAAV,eAAe,CACxB,CAAC,CAED;AACA,MAAO,MAAM,CAAAuB,cAAc,CAAGA,CAAA,GAAM,CAClC,GAAId,MAAM,CAACC,iBAAiB,CAAE,CAC5B,GAAI,CAAED,MAAM,CAACC,iBAAiB,CAACC,KAAK,CAAC,CAAC,CAAE,CAAE,MAAAa,QAAA,CAAM,CAAC,CACjDf,MAAM,CAACC,iBAAiB,CAAG,IAAI,CACjC,CACAV,eAAe,CAAG,IAAI,CAEtB;AACAM,QAAQ,CAACmB,gBAAgB,CAAC,gCAAgC,CAAC,CAACC,OAAO,CAACC,GAAG,EAAI,CACzEA,GAAG,CAACnB,SAAS,CAAG,EAAE,CACpB,CAAC,CAAC,CACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}