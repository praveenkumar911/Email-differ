{"ast":null,"code":"import _defineProperty from \"/home/rcts/Email-differ/Frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport { isThrottlingError } from \"@smithy/service-error-classification\";\nexport class DefaultRateLimiter {\n  constructor(options) {\n    var _options$beta, _options$minCapacity, _options$minFillRate, _options$scaleConstan, _options$smooth;\n    _defineProperty(this, \"beta\", void 0);\n    _defineProperty(this, \"minCapacity\", void 0);\n    _defineProperty(this, \"minFillRate\", void 0);\n    _defineProperty(this, \"scaleConstant\", void 0);\n    _defineProperty(this, \"smooth\", void 0);\n    _defineProperty(this, \"currentCapacity\", 0);\n    _defineProperty(this, \"enabled\", false);\n    _defineProperty(this, \"lastMaxRate\", 0);\n    _defineProperty(this, \"measuredTxRate\", 0);\n    _defineProperty(this, \"requestCount\", 0);\n    _defineProperty(this, \"fillRate\", void 0);\n    _defineProperty(this, \"lastThrottleTime\", void 0);\n    _defineProperty(this, \"lastTimestamp\", 0);\n    _defineProperty(this, \"lastTxRateBucket\", void 0);\n    _defineProperty(this, \"maxCapacity\", void 0);\n    _defineProperty(this, \"timeWindow\", 0);\n    this.beta = (_options$beta = options === null || options === void 0 ? void 0 : options.beta) !== null && _options$beta !== void 0 ? _options$beta : 0.7;\n    this.minCapacity = (_options$minCapacity = options === null || options === void 0 ? void 0 : options.minCapacity) !== null && _options$minCapacity !== void 0 ? _options$minCapacity : 1;\n    this.minFillRate = (_options$minFillRate = options === null || options === void 0 ? void 0 : options.minFillRate) !== null && _options$minFillRate !== void 0 ? _options$minFillRate : 0.5;\n    this.scaleConstant = (_options$scaleConstan = options === null || options === void 0 ? void 0 : options.scaleConstant) !== null && _options$scaleConstan !== void 0 ? _options$scaleConstan : 0.4;\n    this.smooth = (_options$smooth = options === null || options === void 0 ? void 0 : options.smooth) !== null && _options$smooth !== void 0 ? _options$smooth : 0.8;\n    const currentTimeInSeconds = this.getCurrentTimeInSeconds();\n    this.lastThrottleTime = currentTimeInSeconds;\n    this.lastTxRateBucket = Math.floor(this.getCurrentTimeInSeconds());\n    this.fillRate = this.minFillRate;\n    this.maxCapacity = this.minCapacity;\n  }\n  getCurrentTimeInSeconds() {\n    return Date.now() / 1000;\n  }\n  async getSendToken() {\n    return this.acquireTokenBucket(1);\n  }\n  async acquireTokenBucket(amount) {\n    if (!this.enabled) {\n      return;\n    }\n    this.refillTokenBucket();\n    if (amount > this.currentCapacity) {\n      const delay = (amount - this.currentCapacity) / this.fillRate * 1000;\n      await new Promise(resolve => DefaultRateLimiter.setTimeoutFn(resolve, delay));\n    }\n    this.currentCapacity = this.currentCapacity - amount;\n  }\n  refillTokenBucket() {\n    const timestamp = this.getCurrentTimeInSeconds();\n    if (!this.lastTimestamp) {\n      this.lastTimestamp = timestamp;\n      return;\n    }\n    const fillAmount = (timestamp - this.lastTimestamp) * this.fillRate;\n    this.currentCapacity = Math.min(this.maxCapacity, this.currentCapacity + fillAmount);\n    this.lastTimestamp = timestamp;\n  }\n  updateClientSendingRate(response) {\n    let calculatedRate;\n    this.updateMeasuredRate();\n    if (isThrottlingError(response)) {\n      const rateToUse = !this.enabled ? this.measuredTxRate : Math.min(this.measuredTxRate, this.fillRate);\n      this.lastMaxRate = rateToUse;\n      this.calculateTimeWindow();\n      this.lastThrottleTime = this.getCurrentTimeInSeconds();\n      calculatedRate = this.cubicThrottle(rateToUse);\n      this.enableTokenBucket();\n    } else {\n      this.calculateTimeWindow();\n      calculatedRate = this.cubicSuccess(this.getCurrentTimeInSeconds());\n    }\n    const newRate = Math.min(calculatedRate, 2 * this.measuredTxRate);\n    this.updateTokenBucketRate(newRate);\n  }\n  calculateTimeWindow() {\n    this.timeWindow = this.getPrecise(Math.pow(this.lastMaxRate * (1 - this.beta) / this.scaleConstant, 1 / 3));\n  }\n  cubicThrottle(rateToUse) {\n    return this.getPrecise(rateToUse * this.beta);\n  }\n  cubicSuccess(timestamp) {\n    return this.getPrecise(this.scaleConstant * Math.pow(timestamp - this.lastThrottleTime - this.timeWindow, 3) + this.lastMaxRate);\n  }\n  enableTokenBucket() {\n    this.enabled = true;\n  }\n  updateTokenBucketRate(newRate) {\n    this.refillTokenBucket();\n    this.fillRate = Math.max(newRate, this.minFillRate);\n    this.maxCapacity = Math.max(newRate, this.minCapacity);\n    this.currentCapacity = Math.min(this.currentCapacity, this.maxCapacity);\n  }\n  updateMeasuredRate() {\n    const t = this.getCurrentTimeInSeconds();\n    const timeBucket = Math.floor(t * 2) / 2;\n    this.requestCount++;\n    if (timeBucket > this.lastTxRateBucket) {\n      const currentRate = this.requestCount / (timeBucket - this.lastTxRateBucket);\n      this.measuredTxRate = this.getPrecise(currentRate * this.smooth + this.measuredTxRate * (1 - this.smooth));\n      this.requestCount = 0;\n      this.lastTxRateBucket = timeBucket;\n    }\n  }\n  getPrecise(num) {\n    return parseFloat(num.toFixed(8));\n  }\n}\n_defineProperty(DefaultRateLimiter, \"setTimeoutFn\", setTimeout);","map":{"version":3,"names":["isThrottlingError","DefaultRateLimiter","constructor","options","_options$beta","_options$minCapacity","_options$minFillRate","_options$scaleConstan","_options$smooth","_defineProperty","beta","minCapacity","minFillRate","scaleConstant","smooth","currentTimeInSeconds","getCurrentTimeInSeconds","lastThrottleTime","lastTxRateBucket","Math","floor","fillRate","maxCapacity","Date","now","getSendToken","acquireTokenBucket","amount","enabled","refillTokenBucket","currentCapacity","delay","Promise","resolve","setTimeoutFn","timestamp","lastTimestamp","fillAmount","min","updateClientSendingRate","response","calculatedRate","updateMeasuredRate","rateToUse","measuredTxRate","lastMaxRate","calculateTimeWindow","cubicThrottle","enableTokenBucket","cubicSuccess","newRate","updateTokenBucketRate","timeWindow","getPrecise","pow","max","t","timeBucket","requestCount","currentRate","num","parseFloat","toFixed","setTimeout"],"sources":["/home/rcts/Email-differ/Frontend/node_modules/@smithy/util-retry/dist-es/DefaultRateLimiter.js"],"sourcesContent":["import { isThrottlingError } from \"@smithy/service-error-classification\";\nexport class DefaultRateLimiter {\n    static setTimeoutFn = setTimeout;\n    beta;\n    minCapacity;\n    minFillRate;\n    scaleConstant;\n    smooth;\n    currentCapacity = 0;\n    enabled = false;\n    lastMaxRate = 0;\n    measuredTxRate = 0;\n    requestCount = 0;\n    fillRate;\n    lastThrottleTime;\n    lastTimestamp = 0;\n    lastTxRateBucket;\n    maxCapacity;\n    timeWindow = 0;\n    constructor(options) {\n        this.beta = options?.beta ?? 0.7;\n        this.minCapacity = options?.minCapacity ?? 1;\n        this.minFillRate = options?.minFillRate ?? 0.5;\n        this.scaleConstant = options?.scaleConstant ?? 0.4;\n        this.smooth = options?.smooth ?? 0.8;\n        const currentTimeInSeconds = this.getCurrentTimeInSeconds();\n        this.lastThrottleTime = currentTimeInSeconds;\n        this.lastTxRateBucket = Math.floor(this.getCurrentTimeInSeconds());\n        this.fillRate = this.minFillRate;\n        this.maxCapacity = this.minCapacity;\n    }\n    getCurrentTimeInSeconds() {\n        return Date.now() / 1000;\n    }\n    async getSendToken() {\n        return this.acquireTokenBucket(1);\n    }\n    async acquireTokenBucket(amount) {\n        if (!this.enabled) {\n            return;\n        }\n        this.refillTokenBucket();\n        if (amount > this.currentCapacity) {\n            const delay = ((amount - this.currentCapacity) / this.fillRate) * 1000;\n            await new Promise((resolve) => DefaultRateLimiter.setTimeoutFn(resolve, delay));\n        }\n        this.currentCapacity = this.currentCapacity - amount;\n    }\n    refillTokenBucket() {\n        const timestamp = this.getCurrentTimeInSeconds();\n        if (!this.lastTimestamp) {\n            this.lastTimestamp = timestamp;\n            return;\n        }\n        const fillAmount = (timestamp - this.lastTimestamp) * this.fillRate;\n        this.currentCapacity = Math.min(this.maxCapacity, this.currentCapacity + fillAmount);\n        this.lastTimestamp = timestamp;\n    }\n    updateClientSendingRate(response) {\n        let calculatedRate;\n        this.updateMeasuredRate();\n        if (isThrottlingError(response)) {\n            const rateToUse = !this.enabled ? this.measuredTxRate : Math.min(this.measuredTxRate, this.fillRate);\n            this.lastMaxRate = rateToUse;\n            this.calculateTimeWindow();\n            this.lastThrottleTime = this.getCurrentTimeInSeconds();\n            calculatedRate = this.cubicThrottle(rateToUse);\n            this.enableTokenBucket();\n        }\n        else {\n            this.calculateTimeWindow();\n            calculatedRate = this.cubicSuccess(this.getCurrentTimeInSeconds());\n        }\n        const newRate = Math.min(calculatedRate, 2 * this.measuredTxRate);\n        this.updateTokenBucketRate(newRate);\n    }\n    calculateTimeWindow() {\n        this.timeWindow = this.getPrecise(Math.pow((this.lastMaxRate * (1 - this.beta)) / this.scaleConstant, 1 / 3));\n    }\n    cubicThrottle(rateToUse) {\n        return this.getPrecise(rateToUse * this.beta);\n    }\n    cubicSuccess(timestamp) {\n        return this.getPrecise(this.scaleConstant * Math.pow(timestamp - this.lastThrottleTime - this.timeWindow, 3) + this.lastMaxRate);\n    }\n    enableTokenBucket() {\n        this.enabled = true;\n    }\n    updateTokenBucketRate(newRate) {\n        this.refillTokenBucket();\n        this.fillRate = Math.max(newRate, this.minFillRate);\n        this.maxCapacity = Math.max(newRate, this.minCapacity);\n        this.currentCapacity = Math.min(this.currentCapacity, this.maxCapacity);\n    }\n    updateMeasuredRate() {\n        const t = this.getCurrentTimeInSeconds();\n        const timeBucket = Math.floor(t * 2) / 2;\n        this.requestCount++;\n        if (timeBucket > this.lastTxRateBucket) {\n            const currentRate = this.requestCount / (timeBucket - this.lastTxRateBucket);\n            this.measuredTxRate = this.getPrecise(currentRate * this.smooth + this.measuredTxRate * (1 - this.smooth));\n            this.requestCount = 0;\n            this.lastTxRateBucket = timeBucket;\n        }\n    }\n    getPrecise(num) {\n        return parseFloat(num.toFixed(8));\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}