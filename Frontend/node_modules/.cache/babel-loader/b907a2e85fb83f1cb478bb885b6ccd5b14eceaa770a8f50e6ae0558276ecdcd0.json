{"ast":null,"code":"import { setFeature } from \"@aws-sdk/core\";\nimport { HttpRequest } from \"@smithy/protocol-http\";\nimport { S3_EXPRESS_AUTH_SCHEME, S3_EXPRESS_BACKEND, S3_EXPRESS_BUCKET_TYPE, SESSION_TOKEN_HEADER } from \"../constants\";\nexport const s3ExpressMiddleware = options => {\n  return (next, context) => async args => {\n    if (context.endpointV2) {\n      var _endpoint$properties, _endpoint$properties2, _endpoint$properties3;\n      const endpoint = context.endpointV2;\n      const isS3ExpressAuth = ((_endpoint$properties = endpoint.properties) === null || _endpoint$properties === void 0 || (_endpoint$properties = _endpoint$properties.authSchemes) === null || _endpoint$properties === void 0 || (_endpoint$properties = _endpoint$properties[0]) === null || _endpoint$properties === void 0 ? void 0 : _endpoint$properties.name) === S3_EXPRESS_AUTH_SCHEME;\n      const isS3ExpressBucket = ((_endpoint$properties2 = endpoint.properties) === null || _endpoint$properties2 === void 0 ? void 0 : _endpoint$properties2.backend) === S3_EXPRESS_BACKEND || ((_endpoint$properties3 = endpoint.properties) === null || _endpoint$properties3 === void 0 ? void 0 : _endpoint$properties3.bucketType) === S3_EXPRESS_BUCKET_TYPE;\n      if (isS3ExpressBucket) {\n        setFeature(context, \"S3_EXPRESS_BUCKET\", \"J\");\n        context.isS3ExpressBucket = true;\n      }\n      if (isS3ExpressAuth) {\n        const requestBucket = args.input.Bucket;\n        if (requestBucket) {\n          const s3ExpressIdentity = await options.s3ExpressIdentityProvider.getS3ExpressIdentity(await options.credentials(), {\n            Bucket: requestBucket\n          });\n          context.s3ExpressIdentity = s3ExpressIdentity;\n          if (HttpRequest.isInstance(args.request) && s3ExpressIdentity.sessionToken) {\n            args.request.headers[SESSION_TOKEN_HEADER] = s3ExpressIdentity.sessionToken;\n          }\n        }\n      }\n    }\n    return next(args);\n  };\n};\nexport const s3ExpressMiddlewareOptions = {\n  name: \"s3ExpressMiddleware\",\n  step: \"build\",\n  tags: [\"S3\", \"S3_EXPRESS\"],\n  override: true\n};\nexport const getS3ExpressPlugin = options => ({\n  applyToStack: clientStack => {\n    clientStack.add(s3ExpressMiddleware(options), s3ExpressMiddlewareOptions);\n  }\n});","map":{"version":3,"names":["setFeature","HttpRequest","S3_EXPRESS_AUTH_SCHEME","S3_EXPRESS_BACKEND","S3_EXPRESS_BUCKET_TYPE","SESSION_TOKEN_HEADER","s3ExpressMiddleware","options","next","context","args","endpointV2","_endpoint$properties","_endpoint$properties2","_endpoint$properties3","endpoint","isS3ExpressAuth","properties","authSchemes","name","isS3ExpressBucket","backend","bucketType","requestBucket","input","Bucket","s3ExpressIdentity","s3ExpressIdentityProvider","getS3ExpressIdentity","credentials","isInstance","request","sessionToken","headers","s3ExpressMiddlewareOptions","step","tags","override","getS3ExpressPlugin","applyToStack","clientStack","add"],"sources":["/home/rcts/Email-differ/Frontend/node_modules/@aws-sdk/middleware-sdk-s3/dist-es/s3-express/functions/s3ExpressMiddleware.js"],"sourcesContent":["import { setFeature } from \"@aws-sdk/core\";\nimport { HttpRequest } from \"@smithy/protocol-http\";\nimport { S3_EXPRESS_AUTH_SCHEME, S3_EXPRESS_BACKEND, S3_EXPRESS_BUCKET_TYPE, SESSION_TOKEN_HEADER } from \"../constants\";\nexport const s3ExpressMiddleware = (options) => {\n    return (next, context) => async (args) => {\n        if (context.endpointV2) {\n            const endpoint = context.endpointV2;\n            const isS3ExpressAuth = endpoint.properties?.authSchemes?.[0]?.name === S3_EXPRESS_AUTH_SCHEME;\n            const isS3ExpressBucket = endpoint.properties?.backend === S3_EXPRESS_BACKEND ||\n                endpoint.properties?.bucketType === S3_EXPRESS_BUCKET_TYPE;\n            if (isS3ExpressBucket) {\n                setFeature(context, \"S3_EXPRESS_BUCKET\", \"J\");\n                context.isS3ExpressBucket = true;\n            }\n            if (isS3ExpressAuth) {\n                const requestBucket = args.input.Bucket;\n                if (requestBucket) {\n                    const s3ExpressIdentity = await options.s3ExpressIdentityProvider.getS3ExpressIdentity(await options.credentials(), {\n                        Bucket: requestBucket,\n                    });\n                    context.s3ExpressIdentity = s3ExpressIdentity;\n                    if (HttpRequest.isInstance(args.request) && s3ExpressIdentity.sessionToken) {\n                        args.request.headers[SESSION_TOKEN_HEADER] = s3ExpressIdentity.sessionToken;\n                    }\n                }\n            }\n        }\n        return next(args);\n    };\n};\nexport const s3ExpressMiddlewareOptions = {\n    name: \"s3ExpressMiddleware\",\n    step: \"build\",\n    tags: [\"S3\", \"S3_EXPRESS\"],\n    override: true,\n};\nexport const getS3ExpressPlugin = (options) => ({\n    applyToStack: (clientStack) => {\n        clientStack.add(s3ExpressMiddleware(options), s3ExpressMiddlewareOptions);\n    },\n});\n"],"mappings":"AAAA,SAASA,UAAU,QAAQ,eAAe;AAC1C,SAASC,WAAW,QAAQ,uBAAuB;AACnD,SAASC,sBAAsB,EAAEC,kBAAkB,EAAEC,sBAAsB,EAAEC,oBAAoB,QAAQ,cAAc;AACvH,OAAO,MAAMC,mBAAmB,GAAIC,OAAO,IAAK;EAC5C,OAAO,CAACC,IAAI,EAAEC,OAAO,KAAK,MAAOC,IAAI,IAAK;IACtC,IAAID,OAAO,CAACE,UAAU,EAAE;MAAA,IAAAC,oBAAA,EAAAC,qBAAA,EAAAC,qBAAA;MACpB,MAAMC,QAAQ,GAAGN,OAAO,CAACE,UAAU;MACnC,MAAMK,eAAe,GAAG,EAAAJ,oBAAA,GAAAG,QAAQ,CAACE,UAAU,cAAAL,oBAAA,gBAAAA,oBAAA,GAAnBA,oBAAA,CAAqBM,WAAW,cAAAN,oBAAA,gBAAAA,oBAAA,GAAhCA,oBAAA,CAAmC,CAAC,CAAC,cAAAA,oBAAA,uBAArCA,oBAAA,CAAuCO,IAAI,MAAKjB,sBAAsB;MAC9F,MAAMkB,iBAAiB,GAAG,EAAAP,qBAAA,GAAAE,QAAQ,CAACE,UAAU,cAAAJ,qBAAA,uBAAnBA,qBAAA,CAAqBQ,OAAO,MAAKlB,kBAAkB,IACzE,EAAAW,qBAAA,GAAAC,QAAQ,CAACE,UAAU,cAAAH,qBAAA,uBAAnBA,qBAAA,CAAqBQ,UAAU,MAAKlB,sBAAsB;MAC9D,IAAIgB,iBAAiB,EAAE;QACnBpB,UAAU,CAACS,OAAO,EAAE,mBAAmB,EAAE,GAAG,CAAC;QAC7CA,OAAO,CAACW,iBAAiB,GAAG,IAAI;MACpC;MACA,IAAIJ,eAAe,EAAE;QACjB,MAAMO,aAAa,GAAGb,IAAI,CAACc,KAAK,CAACC,MAAM;QACvC,IAAIF,aAAa,EAAE;UACf,MAAMG,iBAAiB,GAAG,MAAMnB,OAAO,CAACoB,yBAAyB,CAACC,oBAAoB,CAAC,MAAMrB,OAAO,CAACsB,WAAW,CAAC,CAAC,EAAE;YAChHJ,MAAM,EAAEF;UACZ,CAAC,CAAC;UACFd,OAAO,CAACiB,iBAAiB,GAAGA,iBAAiB;UAC7C,IAAIzB,WAAW,CAAC6B,UAAU,CAACpB,IAAI,CAACqB,OAAO,CAAC,IAAIL,iBAAiB,CAACM,YAAY,EAAE;YACxEtB,IAAI,CAACqB,OAAO,CAACE,OAAO,CAAC5B,oBAAoB,CAAC,GAAGqB,iBAAiB,CAACM,YAAY;UAC/E;QACJ;MACJ;IACJ;IACA,OAAOxB,IAAI,CAACE,IAAI,CAAC;EACrB,CAAC;AACL,CAAC;AACD,OAAO,MAAMwB,0BAA0B,GAAG;EACtCf,IAAI,EAAE,qBAAqB;EAC3BgB,IAAI,EAAE,OAAO;EACbC,IAAI,EAAE,CAAC,IAAI,EAAE,YAAY,CAAC;EAC1BC,QAAQ,EAAE;AACd,CAAC;AACD,OAAO,MAAMC,kBAAkB,GAAI/B,OAAO,KAAM;EAC5CgC,YAAY,EAAGC,WAAW,IAAK;IAC3BA,WAAW,CAACC,GAAG,CAACnC,mBAAmB,CAACC,OAAO,CAAC,EAAE2B,0BAA0B,CAAC;EAC7E;AACJ,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}